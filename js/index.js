(()=>{let f=0,x=0,h=0,b,C=!1,w,S=!0,M=new Audio("./move.mp3"),$=localStorage.getItem("results")?JSON.parse(localStorage.getItem("results")):[];const y=document.createElement("div"),t=document.createElement("h1"),e=document.createElement("div"),k=document.createElement("button"),I=document.createElement("button"),T=document.createElement("button"),q=document.createElement("button"),n=document.createElement("div"),O=document.createElement("button"),A=document.createElement("span"),N=document.createElement("span"),W=document.createElement("div"),a=document.createElement("div"),s=document.createElement("span"),J=document.createElement("span"),l=document.createElement("div"),o=document.createElement("span"),d=document.createElement("button"),c=document.createElement("button"),r=document.createElement("button"),i=document.createElement("button"),u=document.createElement("button"),m=document.createElement("button");function P(){const e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("h2"),a=document.createElement("div"),s=document.createElement("div"),l=document.createElement("button"),o=document.createElement("button");e.classList.add("r-modal-wrap"),t.classList.add("modal"),n.classList.add("modal__title"),a.classList.add("modal__wrap"),s.classList.add("modal__row"),l.classList.add("modal__close"),o.classList.add("modal__btn"),n.textContent="Best results!",o.textContent="Okay";const d=document.createElement("div");d.textContent="Place";const c=document.createElement("div");c.textContent="Moves";const r=document.createElement("div");for(var i in r.textContent="Time",d.classList.add("cell"),c.classList.add("cell"),r.classList.add("cell"),s.append(d,c,r),a.append(s),$){const u=document.createElement("div");u.classList.add("modal__row");const m=document.createElement("div");m.textContent=`${+i+1}`;const v=document.createElement("div");v.textContent=`${$[i].moves}`;const p=document.createElement("div");p.textContent=`${9<$[i].minutes?$[i].minutes:"0"+$[i].minutes}:${9<$[i].seconds?$[i].seconds:"0"+$[i].seconds}`,m.classList.add("cell"),v.classList.add("cell"),p.classList.add("cell"),u.append(m,v,p),a.append(u)}return e.append(t),t.append(n,a,l,o),y.append(e),o.addEventListener("click",t=>{e.classList.remove("r-modal-wrap--active")}),l.addEventListener("click",t=>{e.classList.remove("r-modal-wrap--active")}),e.addEventListener("click",t=>{t.target===e&&e.remove()}),{resultsModalWrap:e,resultsModalBtn:o,resultsModalClose:l}}y.classList.add("page"),e.classList.add("controllers"),k.classList.add("shuffle","controllers__btn"),I.classList.add("stop","controllers__btn"),T.classList.add("save","controllers__btn"),q.classList.add("result","controllers__btn"),n.classList.add("puzzle-info"),O.classList.add("puzzle-info__sound-btn","puzzle-info__sound-btn--active"),A.classList.add("puzzle-info__moves"),N.classList.add("puzzle-info__timer"),W.classList.add("puzzle"),a.classList.add("puzzle-cur-size"),s.classList.add("puzzle-cur-size__text"),J.classList.add("puzzle-cur-size__size"),l.classList.add("puzzle-sizes"),o.classList.add("puzzle-sizes__text"),d.classList.add("puzzle-sizes__btn"),c.classList.add("puzzle-sizes__btn","active"),r.classList.add("puzzle-sizes__btn"),i.classList.add("puzzle-sizes__btn"),u.classList.add("puzzle-sizes__btn"),m.classList.add("puzzle-sizes__btn"),e.append(k,I,T,q),n.append(O,A,N),a.append(s,J),l.append(o,d,c,r,i,u,m),y.append(t,e,n,W,a,l),t.textContent="I have a puzzle for you!",k.textContent="Shuffle and start",I.textContent="Stop",T.textContent="Save",q.textContent="Results",O.textContent="Sound",A.textContent=`Moves: ${f}`,N.textContent="Time: 00:00",s.textContent="Frame size: ",J.textContent="4x4",o.textContent="Other sizes:",d.textContent="3x3",c.textContent="4x4",r.textContent="5x5",i.textContent="6x6",u.textContent="7x7",m.textContent="8x8",d.dataset.value=3,c.dataset.value=4,r.dataset.value=5,i.dataset.value=6,u.dataset.value=7,m.dataset.value=8,P(),function(){let e=localStorage.getItem("savedPuzzle")?JSON.parse(localStorage.getItem("savedPuzzle")):null;const t=document.body;t.append(y);let o,l,d,c,r;var n,a;e?(f=e.moves,x=e.seconds,h=e.minutes,n=x.toString(),a=h.toString(),C=!0,A.textContent=`Moves: ${f}`,N.textContent=`Time: ${1<a.length?a:"0"+a}:${1<n.length?n:"0"+n}`,p(e.fieldSize,e.grid)):p();const s=document.querySelectorAll(".puzzle-sizes__btn");function i(t,e){return inversCnt=function(t){let n=0;var a=t.slice().filter(t=>t!==r);for(let e=0;e<a.length;e++){var s=a[e];for(let t=e+1;t<a.length;t++)secondItem=a[t],s>secondItem&&(n+=1)}return n}(e),t%2==0&&(t-Math.floor(e.indexOf(t*t)/t))%2==0?inversCnt%2!=0:inversCnt%2==0}function u(){b&&(clearInterval(b),C=!0)}function m(){f=0,x=0,h=0,A.textContent=`Moves: ${f}`,N.textContent="Time: 00:00"}function v(){let t=x.toString(),e=h.toString();return x<59?(x+=1,t=x.toString(),e=h.toString()):59===h&&59===x?clearInterval(setTimer):59===x&&(x=0,h+=1,t=x.toString(),e=h.toString()),`${1<e.length?e:"0"+e}:${1<t.length?t:"0"+t}`}function p(e=16,t){for(let t=0;t<e;t++){const a=document.createElement("button"),s=document.createElement("span");s.textContent=t+1,a.classList.add("item"),a.style.width=`${100/Math.sqrt(e)}%`,a.style.height=`${100/Math.sqrt(e)}%`,a.dataset.gridId=t+1,a.append(s),W.append(a)}o=Array.from(document.querySelectorAll(".item")),l=o.map(t=>Number(t.dataset.gridId));let n=L(l.slice());for(;!i(Math.sqrt(e),n);)n=L(l.slice());d=t||function(e){const n=[];for(let t=0;t<Math.sqrt(e.length);t++)n.push([]);let a=0,s=0;for(let t=0;t<e.length;t++)s>=Math.sqrt(e.length)&&(a++,s=0),n[a][s]=e[t],s++;return n}(n),setTimeout(()=>{z(d)},100),c=o[o.length-1],r=o.length,c.style.display="none"}function z(n){for(let e=0;e<n.length;e++)for(let t=0;t<n.length;t++){var a=n[e][t],s=o[a-1];l=t,a=e,s.style.transform=`translate3D(${100*l}%, ${100*a}%, 0)`}var l}function L(t){return t.map(t=>({value:t,sort:Math.random()})).sort((t,e)=>t.sort-e.sort).map(({value:t})=>t)}function _(n,a){for(let e=0;e<a.length;e++)for(let t=0;t<a[e].length;t++)if(a[e][t]===n)return{row:t,col:e};return null}function E(t,e,n){f||(C=!1,b=setInterval(()=>{N.textContent=`Time: ${v()}`},1e3)),f&&C&&(b=setInterval(()=>{N.textContent=`Time: ${v()}`},1e3),C=!1),f+=1,1==S&&M.play(),A.textContent=`Moves: ${f}`;var a=n[t.col][t.row];n[t.col][t.row]=n[e.col][e.row],n[e.col][e.row]=a,function(t){var e=t.flat();for(let t=0;t<l.length;t++)if(e[t]!==l[t])return!1;return!0}(n)&&(clearInterval(b),C=!0,setTimeout(()=>{y.classList.add(g),setTimeout(()=>{y.classList.remove(g),w.winModalWrap.classList.add("modal-wrap--active")},1e3)},200),n={moves:f,seconds:x,minutes:h},$.push(n),$=$.sort((t,e)=>{var n=t.seconds+60*t.minutes,a=e.seconds+60*e.minutes;return n===a?t.moves-e.moves:n-a}).slice(0,10),localStorage.setItem("results",JSON.stringify($)),w=function(){const e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("h2"),a=document.createElement("p"),s=document.createElement("button"),l=document.createElement("button");e.classList.add("modal-wrap"),t.classList.add("modal"),n.classList.add("modal__title"),a.classList.add("modal__text"),s.classList.add("modal__close"),l.classList.add("modal__btn");var o=x.toString(),d=h.toString();return n.textContent="Hooray!",a.textContent=`You solved the puzzle in ${1<d.length?d:"0"+d}:${1<o.length?o:"0"+o} and ${f} moves!`,l.textContent="Okay",e.append(t),t.append(n,a,s,l),y.append(e),l.addEventListener("click",t=>{e.classList.remove("modal-wrap--active")}),s.addEventListener("click",t=>{e.classList.remove("modal-wrap--active")}),e.addEventListener("click",t=>{t.target===e&&e.remove()}),{winModalWrap:e,winModal:t,winModalBtn:l,winModalClose:s}}(),m())}e&&s.forEach(t=>{t.classList.remove("active"),+t.dataset.value===Math.sqrt(e.fieldSize)&&(t.classList.add("active"),J.textContent=`${t.dataset.value}x${t.dataset.value}`)}),s.forEach(t=>{t.addEventListener("click",t=>{clearInterval(b),s.forEach(t=>t.classList.remove("active")),t.target.classList.add("active"),J.textContent=`${t.target.dataset.value}x${t.target.dataset.value}`;t=Math.pow(t.target.dataset.value,2);W.innerHTML="",m(),C=!0,p(t)})}),k.addEventListener("click",()=>{clearInterval(b),m(),C=!1,W.innerHTML="",p(Math.pow(document.querySelector(".puzzle-sizes__btn.active").dataset.value,2))}),I.addEventListener("click",()=>{u()}),T.addEventListener("click",()=>{u();var t=document.querySelector(".puzzle-sizes__btn.active").dataset.value;e={moves:f,seconds:x,minutes:h,grid:d,fieldSize:t*t},localStorage.setItem("savedPuzzle",JSON.stringify(e))}),q.addEventListener("click",t=>{const e=P();e.resultsModalWrap.classList.add("r-modal-wrap--active")}),O.addEventListener("click",()=>{O.classList.toggle("puzzle-info__sound-btn--active"),O.classList.toggle("puzzle-info__sound-btn--disable"),S=!S}),W.addEventListener("click",t=>{var e,n,a,s=t.target.closest("button");s&&(e=_(Number(s.dataset.gridId),d),n=_(r,d),a=n,t=e,s=Math.abs(a.row-t.row),1!==Math.abs(a.col-t.col)&&1!==s||a.row!==t.row&&a.col!==t.col||(E(e,n,d),z(d)))}),window.addEventListener("keydown",t=>{if(t.key.includes("Arrow")){var e=_(r,d);const n={row:e.row,col:e.col};switch(t.key.split("Arrow")[1].toLowerCase()){case"up":n.col+=1;break;case"down":--n.col;break;case"left":n.row+=1;break;case"right":--n.row}n.col>=d.length||n.col<0||n.row>=d.length||n.row<0||(E(e,n,d),z(d))}});const g="youWon"}()})();